avgcost2$name[avgcost2$name=="Stevie Johnson"]
projections[projections$name=="Stevie Johnson"]
projections[projections$name=="Steve Johnson"]
projections[projections$name=="Steve Johnson",]
projections[projections$name=="Stevie Johnson",]
load(paste(getwd(),"/Data/VOR-2012.RData", sep=""))
avgcost <- read.csv(paste(strsplit(path,"/Indiana/Research/Data")[[1]],"/Fantasy Football/Research/R/avgcost.csv",sep=""))
avgcost2 <- avgcost[which(avgcost$Avg.Cost!=""),]
avgcost2$name <- avgcost2$Player
avgcost2$avgCost <- as.numeric((str_replace_all(avgcost2$Avg.Cost, "\\$", "")))
avgcost3 <- avgcost2[,c("name","avgCost")]
avgcost3$projectedCost <- ceiling(avgcost3$avgCost * (leagueCap/defaultCap))
avgcost2$name[avgcost2$name=="Stevie Johnson"]
avgcost3$name[avgcost3$name=="Stevie Johnson"] <- "Steve Johnson"
str(avgcost3)
avgcost <- read.csv(paste(strsplit(path,"/Indiana/Research/Data")[[1]],"/Fantasy Football/Research/R/avgcost.csv",sep=""))
avgcost2 <- avgcost[which(avgcost$Avg.Cost!=""),]
avgcost2$name <- as.character(avgcost2$Player)
avgcost2$avgCost <- as.numeric((str_replace_all(avgcost2$Avg.Cost, "\\$", "")))
avgcost3 <- avgcost2[,c("name","avgCost")]
avgcost3$projectedCost <- ceiling(avgcost3$avgCost * (leagueCap/defaultCap))
str(avgcost3)
avgcost3$name[avgcost3$name=="Stevie Johnson"] <- "Steve Johnson"
avgcost3$name[avgcost3$name=="Stevie Johnson"] <- "Steve Johnson"
projections <- merge(projections, avgcost3, by="name", all.x=TRUE)
projections$projectedCost[is.na(projections$projectedCost)==TRUE] <- 1
projections <- projections[order(projections$overallRank),]
#Remove duplicate cases
projections[duplicated(projections$name),]
projections$inflatedCost <- ceiling(projections$avgCost * (leagueCap/defaultCap) * 1.0)
projections$inflatedCost[projections$overallRank <= 33] <- ceiling(projections$avgCost[projections$overallRank <= 33] * (leagueCap/defaultCap) * 1.1)
projections$inflatedCost[projections$overallRank >= 67] <- ceiling(projections$avgCost[projections$overallRank >= 67] * (leagueCap/defaultCap) * 0.9)
projections$inflatedCost[is.na(projections$inflatedCost)==TRUE] <- 1
#Density Plot
ggplot(projections, aes(x=inflatedCost)) + geom_density(fill="green", alpha=.3) + xlab("Player's Intrinsic Value (Cost)") + ggtitle("Density Plot of Players' Values from 2012") + theme(legend.title=element_blank())
ggsave(paste(getwd(),"/Figures/Inflated Cost 2012.jpg", sep=""))
#Save file
save(projections, file = paste(getwd(),"/Data/AvgCost-2012.RData", sep=""))
leagueCap <- 225
numQBstarters <- 1
numRBstarters <- 2
numWRstarters <- 2
numTEstarters <- 1
numTotalStarters <- 7
numTotalPlayers <- 20
maxRisk <- 5
#Library
library("Rglpk")
#Load data
load(paste(getwd(),"/Data/AvgCost-2012.RData", sep=""))
#Roster Optimization
optimizeData <- na.omit(projections[,c("name","pos","projectedPtsLatent","risk","inflatedCost")])
maxCost <- leagueCap - (numTotalPlayers - numTotalStarters)
optimizeTeam <- function(points=optimizeData$projectedPtsLatent, playerCost=optimizeData$inflatedCost, maxRisk=maxRisk){ #can change points, cost, or risk
num.players <- length(optimizeData$name)
var.types <- rep("B", num.players)
A <- rbind(as.numeric(optimizeData$pos == "QB"), # num QB
as.numeric(optimizeData$pos == "RB"), # num RB
as.numeric(optimizeData$pos == "WR"), # num WR
as.numeric(optimizeData$pos == "TE"), # num TE
diag(optimizeData$risk),              # player's risk
playerCost,                           # total cost
rep(1,num.players))                   # num of players in starting lineup
dir <- c("==",
">=",
">=",
">=",
rep("<=", num.players),
"<=",
"==")
b <- c(numQBstarters,
numRBstarters,
numWRstarters,
numTEstarters,
rep(maxRisk, num.players),
maxCost,
numTotalStarters)
sol <- Rglpk_solve_LP(obj = points, mat = A, dir = dir, rhs = b,types = var.types, max = TRUE)
sol$playerInfo <- as.data.frame(cbind(optimizeData[sol$solution == 1,"name"],points[sol$solution == 1],optimizeData[sol$solution == 1,"risk"],playerCost[sol$solution == 1]))
names(sol$playerInfo) <- c("name","points","risk","cost")
sol$totalCost <- sum(optimizeData$inflatedCost * sol$solution)
sol$players <- optimizeData$name[sol$solution == 1]
return(sol)
}
optimizeTeam(maxRisk=maxRisk)
optimizeTeam(maxRisk=100)
optimizeTeam <- function(points=optimizeData$projectedPtsLatent, playerCost=optimizeData$inflatedCost, maxRisk=maxRisk){ #can change points, cost, or risk
num.players <- length(optimizeData$name)
var.types <- rep("B", num.players)
A <- rbind(as.numeric(optimizeData$pos == "QB"), # num QB
as.numeric(optimizeData$pos == "RB"), # num RB
as.numeric(optimizeData$pos == "WR"), # num WR
as.numeric(optimizeData$pos == "TE"), # num TE
diag(optimizeData$risk),              # player's risk
playerCost,                           # total cost
rep(1,num.players))                   # num of players in starting lineup
dir <- c("==",
">=",
">=",
">=",
rep("<=", num.players),
"<=",
"==")
b <- c(numQBstarters,
numRBstarters,
numWRstarters,
numTEstarters,
rep(maxRisk, num.players),
maxCost,
numTotalStarters)
sol <- Rglpk_solve_LP(obj = points, mat = A, dir = dir, rhs = b,types = var.types, max = TRUE)
sol$playerInfo <- as.data.frame(cbind(optimizeData[sol$solution == 1,"name"],round(points[sol$solution == 1],3),round(optimizeData[sol$solution == 1,"risk"],3),playerCost[sol$solution == 1]))
names(sol$playerInfo) <- c("name","points","risk","cost")
sol$totalCost <- sum(optimizeData$inflatedCost * sol$solution)
sol$players <- optimizeData$name[sol$solution == 1]
return(sol)
}
optimizeTeam(maxRisk=maxRisk)
optimizeTeam(maxRisk=100)
projectedPoints <- vector(mode="numeric", length=length(seq(0, max(optimizeData$risk), 0.1)))
riskLevel <- vector(mode="numeric", length=length(seq(0, max(optimizeData$risk), 0.1)))
j <- 1
pb <- txtProgressBar(min = 0, max = max(optimizeData$risk), style = 3)
for (i in seq(0, max(optimizeData$risk), 0.1)){
setTxtProgressBar(pb, i)
projectedPoints[j] <- optimizeTeam(maxRisk=i)$optimum
riskLevel[j] <- i
j <- j+1
}
plot(riskLevel,projectedPoints)
riskData <- as.data.frame(cbind(riskLevel,projectedPoints))
riskData[match(unique(riskData$projectedPoints),riskData$projectedPoints),c("riskLevel","projectedPoints")]
optimizeTeam(maxRisk=3.8)
ggplot(aes(x=riskLevel, y=projectedPoints)) + geom_point() + geom_smooth() + xlab("Projected Fantasy Football Points") + ylab("Actual Fantasy Football Points") + ggtitle("Associaton Between Projected Fantasy Points and Actual Points")
plot(riskLevel,projectedPoints)
riskLevel
riskData
ggplot(data=riskData, aes(x=riskLevel, y=projectedPoints)) + geom_point() + geom_smooth() + xlab("Projected Fantasy Football Points") + ylab("Actual Fantasy Football Points") + ggtitle("Associaton Between Projected Fantasy Points and Actual Points")
ggplot(data=riskData, aes(x=riskLevel, y=projectedPoints)) + geom_point() + geom_smooth() + xlab("Max Risk Level") + ylab("Total Projected Points") + ggtitle("Association Between Max Risk Level and Total Projected Points")
?geom_smooth
ggplot(data=riskData, aes(x=riskLevel, y=projectedPoints)) + geom_point() + xlab("Max Risk Level") + ylab("Total Projected Points") + ggtitle("Association Between Max Risk Level and Total Projected Points") +
stat_smooth(method = "glm", family = binomial) # + geom_smooth()
?stat_smooth
ggplot(data=riskData, aes(x=riskLevel, y=projectedPoints)) + geom_point() + xlab("Max Risk Level") + ylab("Total Projected Points") + ggtitle("Association Between Max Risk Level and Total Projected Points") +
stat_smooth(method = "glm") # + geom_smooth()
ggplot(data=riskData, aes(x=riskLevel, y=projectedPoints)) + geom_point() + xlab("Max Risk Level") + ylab("Total Projected Points") + ggtitle("Association Between Max Risk Level and Total Projected Points") +
stat_smooth() # + geom_smooth()
ggplot(data=riskData, aes(x=riskLevel, y=projectedPoints)) + geom_point() + geom_smooth() + xlab("Max Risk Level") + ylab("Total Projected Points") + ggtitle("Association Between Max Risk Level and Total Projected Points")
ggplot(data=riskData, aes(x=riskLevel, y=projectedPoints)) + geom_point() + xlab("Max Risk Level") + ylab("Total Projected Points") + ggtitle("Association Between Max Risk Level and Total Projected Points")
#+ stat_smooth(method = "glm", family = binomial)
+stat_smooth(method="lm", model = log(y) ~ x)
ggplot(data=riskData, aes(x=riskLevel, y=projectedPoints)) + geom_point() + xlab("Max Risk Level") + ylab("Total Projected Points") + ggtitle("Association Between Max Risk Level and Total Projected Points")
#+ stat_smooth(method = "glm", family = binomial)
+stat_smooth(method="lm", model = log(projectedPoints) ~ riskLevel)
ggplot(data=riskData, aes(x=riskLevel, y=projectedPoints)) + geom_point(2) + geom_smooth() + xlab("Max Risk Level") + ylab("Total Projected Points") + ggtitle("Association Between Max Risk Level and Total Projected Points")
?geom_point
ggplot(data=riskData, aes(x=riskLevel, y=projectedPoints)) + geom_point(size=2) + geom_smooth() + xlab("Max Risk Level") + ylab("Total Projected Points") + ggtitle("Association Between Max Risk Level and Total Projected Points")
ggplot(data=riskData, aes(x=riskLevel, y=projectedPoints)) + geom_point(size=2) + xlab("Max Risk Level") + ylab("Total Projected Points") + ggtitle("Association Between Max Risk Level and Total Projected Points")
ggplot(data=riskData, aes(x=riskLevel, y=projectedPoints)) + geom_point(size=5) + xlab("Max Risk Level") + ylab("Total Projected Points") + ggtitle("Association Between Max Risk Level and Total Projected Points")
ggplot(data=riskData, aes(x=riskLevel, y=projectedPoints)) + geom_point(size=3) + xlab("Max Risk Level") + ylab("Total Projected Points") + ggtitle("Association Between Max Risk Level and Total Projected Points")
optimizeTeam(maxRisk=3.8)
riskData[match(unique(riskData$projectedPoints),riskData$projectedPoints),c("riskLevel","projectedPoints")]
optimizeTeam(maxRisk=3.8)
riskData[match(unique(riskData$projectedPoints),riskData$projectedPoints),c("riskLevel","projectedPoints")]
optimizeTeam(maxRisk=3.8) #optimal
optimizeTeam <- function(points=optimizeData$projectedPtsLatent, playerCost=optimizeData$inflatedCost, maxRisk=maxRisk){ #can change points, cost, or risk
num.players <- length(optimizeData$name)
var.types <- rep("B", num.players)
A <- rbind(as.numeric(optimizeData$pos == "QB"), # num QB
as.numeric(optimizeData$pos == "RB"), # num RB
as.numeric(optimizeData$pos == "WR"), # num WR
as.numeric(optimizeData$pos == "TE"), # num TE
diag(optimizeData$risk),              # player's risk
playerCost,                           # total cost
rep(1,num.players))                   # num of players in starting lineup
dir <- c("==",
">=",
">=",
">=",
rep("<=", num.players),
"<=",
"==")
b <- c(numQBstarters,
numRBstarters,
numWRstarters,
numTEstarters,
rep(maxRisk, num.players),
maxCost,
numTotalStarters)
sol <- Rglpk_solve_LP(obj = points, mat = A, dir = dir, rhs = b,types = var.types, max = TRUE)
sol$playerInfo <- as.data.frame(cbind(optimizeData[sol$solution == 1,"name"],round(points[sol$solution == 1],2),round(optimizeData[sol$solution == 1,"risk"],2),playerCost[sol$solution == 1]))
names(sol$playerInfo) <- c("name","points","risk","cost")
sol$totalCost <- sum(optimizeData$inflatedCost * sol$solution)
sol$players <- optimizeData$name[sol$solution == 1]
return(sol)
}
optimizeTeam(maxRisk=maxRisk)
optimizeTeam(maxRisk=100)
optimizeTeam(maxRisk=maxRisk)
optimizeTeam(maxRisk=100)
listOfPlayers <- vector(mode="character", length=numTotalStarters)
bidUpTo <- vector(mode="numeric", length=length(optimizeData$name))
newCost <- optimizeData$inflatedCost
pb <- txtProgressBar(min = 0, max = length(optimizeData$name), style = 3)
for(i in 1:length(optimizeData$name)){
setTxtProgressBar(pb, i)
j <- 1
listOfPlayers <- rep(optimizeData$name[i],numTotalStarters)
newCost <- optimizeData$inflatedCost
while(!is.na(match(optimizeData$name[i],listOfPlayers))){
newCost[i] <- j
listOfPlayers <- optimizeTeam(points=optimizeData$projectedPts, playerCost=newCost, maxRisk=(max(optimizeData$risk)+1)$players  #UPDATE: maxrisk
bidUpTo[i] <- j
j <- j+1
}
pb <- txtProgressBar(min = 0, max = length(optimizeData$name), style = 3)
for(i in 1:length(optimizeData$name)){
setTxtProgressBar(pb, i)
j <- 1
listOfPlayers <- rep(optimizeData$name[i],numTotalStarters)
newCost <- optimizeData$inflatedCost
while(!is.na(match(optimizeData$name[i],listOfPlayers))){
newCost[i] <- j
listOfPlayers <- optimizeTeam(points=optimizeData$projectedPts, playerCost=newCost, maxRisk=(max(optimizeData$risk)+1))$players  #UPDATE: maxrisk
bidUpTo[i] <- j
j <- j+1
}
}
optimizeData$bidUpTo <- bidUpTo - 1
optimizeData$bidUpTo[optimizeData$bidUpTo==0] <- 1
projections <- merge(projections, optimizeData, all.x=TRUE)
projections <- projections[order(projections$overallRank),]
projections$bidUpTo[is.na(projections$bidUpTo)] <- 1
row.names(projections) <- 1:max(as.numeric(row.names(projections)))
projections
save(projections, file = paste(getwd(),"/Data/BidUpTo-2012.RData", sep=""))
projections
numTeams <- 10
numQB <- 1
numRB <- 2.5
numWR <- 2.5
numTE <- 1
#Load data
load(paste(getwd(),"/Data/Risk-2012.RData", sep=""))
#Calculate Value over Replacement
qb <- projections[projections$pos=="QB",][order(projections[projections$pos=="QB",]$overallRank),]
rb <- projections[projections$pos=="RB",][order(projections[projections$pos=="RB",]$overallRank),]
wr <- projections[projections$pos=="WR",][order(projections[projections$pos=="WR",]$overallRank),]
te <- projections[projections$pos=="TE",][order(projections[projections$pos=="TE",]$overallRank),]
qb$positionRank <- rank(-qb$projectedPtsLatent, ties.method="min")
rb$positionRank <- rank(-rb$projectedPtsLatent, ties.method="min")
wr$positionRank <- rank(-wr$projectedPtsLatent, ties.method="min")
te$positionRank <- rank(-te$projectedPtsLatent, ties.method="min")
qbReplacements <- print(ceiling(numQB*numTeams*1.5))
rbReplacements <- print(ceiling(numRB*numTeams*1.5))
wrReplacements <- print(ceiling(numWR*numTeams*1.5))
teReplacements <- print(ceiling(numTE*numTeams*1.5))
qbValueOfReplacement <- print(mean(c(qb$projectedPts[qb$positionRank==qbReplacements],qb$projectedPts[qb$positionRank==(qbReplacements-1)],qb$projectedPts[qb$positionRank==(qbReplacements+1)])))
rbValueOfReplacement <- print(mean(c(rb$projectedPts[rb$positionRank==rbReplacements],rb$projectedPts[rb$positionRank==(rbReplacements-1)],rb$projectedPts[rb$positionRank==(rbReplacements+1)])))
wrValueOfReplacement <- print(mean(c(wr$projectedPts[wr$positionRank==wrReplacements],wr$projectedPts[wr$positionRank==(wrReplacements-1)],wr$projectedPts[wr$positionRank==(wrReplacements+1)])))
teValueOfReplacement <- print(mean(c(te$projectedPts[te$positionRank==teReplacements],te$projectedPts[te$positionRank==(teReplacements-1)],te$projectedPts[te$positionRank==(teReplacements+1)])))
qb$vor <- qb$projectedPts - qbValueOfReplacement
rb$vor <- rb$projectedPts - rbValueOfReplacement
wr$vor <- wr$projectedPts - wrValueOfReplacement
te$vor <- te$projectedPts - teValueOfReplacement
#Merge across positions
projections <- rbind(qb,rb,wr,te)
#Calculate overall rank by VOR
projections$overallRank <- rank(-projections$vor, ties.method="min")
#Order players by overall rank
projections <- projections[order(projections$overallRank),]
row.names(projections) <- 1:dim(projections)[1]
#Reorder variables
projections <- projections[,c("name","pos","team","overallRank","pick","positionRank","projectedPts_espn","projectedPts_cbs","projectedPts_nfl","projectedPts","projectedPtsLatent","vor","sdPick","sdPts","risk")]
#Starters (low risk)
projections[which(projections$risk <= 5 & projections$vor >= 0),]
#Sleepers (high risk)
projections[which(projections$risk >=5 & projections$vor >= 0),]
qplot(pos, vor, data=projections, geom=c("boxplot", "jitter"), fill=gear, main="Mileage by Gear Number", xlab="", ylab="Value Over Replacement")
qplot(pos, vor, data=projections, geom=c("boxplot", "jitter"), fill=pos, main="Mileage by Gear Number", xlab="", ylab="Value Over Replacement")
qplot(pos, vor, data=projections, geom=c("boxplot", "jitter"), fill=pos, main="Value Over Replacement By Position", xlab="", ylab="Value Over Replacement")
qplot(pos, vor, data=projections, geom=c("boxplot", "jitter"), fill=pos, main="Value Over Replacement By Position", xlab="", ylab="Value Over Replacement")
qplot(pos, vor, data=projections, geom=c("boxplot"), fill=pos, main="Value Over Replacement By Position", xlab="", ylab="Value Over Replacement")
qplot(pos, vor, data=projections, geom=c("boxplot", "jitter"), fill=pos, main="Value Over Replacement By Position", xlab="", ylab="Value Over Replacement")
source('~/GitHub/FantasyFootballAnalyticsR/R Scripts/Value Over Replacement.R', echo=TRUE)
projections
names(projections)
draftData <- ffball2[,c("name","team","pos","projectedPtsLatent","vor","sdPick","sdPts","risk","avgCost","inflatedCost","bidUpTo")]
draftData <- projections[,c("name","team","pos","projectedPtsLatent","vor","sdPick","sdPts","risk","avgCost","inflatedCost","bidUpTo")]
load(paste(getwd(),"/Data/AvgCost-2012.RData", sep=""))
#Subset data
draftData <- projections[,c("name","team","pos","projectedPtsLatent","vor","sdPick","sdPts","risk","avgCost","inflatedCost","bidUpTo")]
names(projections)
load(paste(getwd(),"/Data/BidUpTo-2012.RData", sep=""))
#Subset data
draftData <- projections[,c("name","pos","team","projectedPtsLatent","vor","sdPick","sdPts","risk","avgCost","inflatedCost","bidUpTo")]
draftData
removedPlayers <- na.omit(draftData)
removedPlayers
maxRisk <- 3.8
#Library
library("Rglpk")
#Load data
load(paste(getwd(),"/Data/BidUpTo-2012.RData", sep=""))
#Subset data
draftData <- projections[,c("name","pos","team","projectedPtsLatent","vor","sdPick","sdPts","risk","avgCost","inflatedCost","bidUpTo")]
draftData
#Day of Draft
removedPlayers <- na.omit(draftData)
removedPlayers
optimizeDraft <- function(points=removedPlayers$projectedPtsLatent, playerCost=removedPlayers$inflatedCost, maxRisk=maxRisk, omit=NULL){ #can change points, cost, or risk
if (length(omit) > 0){
for(i in 1:length(omit)){
removedPlayers <- removedPlayers[-which(removedPlayers$name==omit[i]),]
}
} else {}
num.players <- length(removedPlayers$name)
var.types <- rep("B", num.players)
A <- rbind(as.numeric(removedPlayers$pos == "QB"), # num QB
as.numeric(removedPlayers$pos == "RB"), # num RB
as.numeric(removedPlayers$pos == "WR"), # num WR
as.numeric(removedPlayers$pos == "TE"), # num TE
diag(removedPlayers$risk),              # player's risk
playerCost,                           # total cost
rep(1,num.players))                   # num of players in starting lineup
dir <- c("==",
">=",
">=",
">=",
rep("<=", num.players),
"<=",
"==")
b <- c(numQBstarters,
numRBstarters,
numWRstarters,
numTEstarters,
rep(maxRisk, num.players),
maxCost,
numTotalstarters)
sol <- Rglpk_solve_LP(obj = points, mat = A, dir = dir, rhs = b,types = var.types, max = TRUE)
sol$playerInfo <- as.data.frame(cbind(removedPlayers[sol$solution == 1,"name"],round(points[sol$solution == 1],2),round(removedPlayers[sol$solution == 1,"risk"],2),removedPlayers[sol$solution == 1,"avgCost"],playerCost[sol$solution == 1],removedPlayers[sol$solution == 1,"bidUpTo"]))
names(sol$playerInfo) <- c("name","points","risk","avgCost","inflatedCost","bidUpTo")
sol$totalCost <- sum(removedPlayers$inflatedCost * sol$solution)
sol$players <- removedPlayers$name[sol$solution == 1]
return(sol)
}
optimizeDraft(maxRisk=3.8)
leagueCap <- 225
numQBstarters <- 1
numRBstarters <- 2
numWRstarters <- 2
numTEstarters <- 1
numTotalStarters <- 7
numTotalPlayers <- 20
maxRisk <- 3.8
maxCost <- leagueCap - (numTotalPlayers - numTotalStarters)
optimizeDraft <- function(points=removedPlayers$projectedPtsLatent, playerCost=removedPlayers$inflatedCost, maxRisk=maxRisk, omit=NULL){ #can change points, cost, or risk
if (length(omit) > 0){
for(i in 1:length(omit)){
removedPlayers <- removedPlayers[-which(removedPlayers$name==omit[i]),]
}
} else {}
num.players <- length(removedPlayers$name)
var.types <- rep("B", num.players)
A <- rbind(as.numeric(removedPlayers$pos == "QB"), # num QB
as.numeric(removedPlayers$pos == "RB"), # num RB
as.numeric(removedPlayers$pos == "WR"), # num WR
as.numeric(removedPlayers$pos == "TE"), # num TE
diag(removedPlayers$risk),              # player's risk
playerCost,                           # total cost
rep(1,num.players))                   # num of players in starting lineup
dir <- c("==",
">=",
">=",
">=",
rep("<=", num.players),
"<=",
"==")
b <- c(numQBstarters,
numRBstarters,
numWRstarters,
numTEstarters,
rep(maxRisk, num.players),
maxCost,
numTotalstarters)
sol <- Rglpk_solve_LP(obj = points, mat = A, dir = dir, rhs = b,types = var.types, max = TRUE)
sol$playerInfo <- as.data.frame(cbind(removedPlayers[sol$solution == 1,"name"],round(points[sol$solution == 1],2),round(removedPlayers[sol$solution == 1,"risk"],2),removedPlayers[sol$solution == 1,"avgCost"],playerCost[sol$solution == 1],removedPlayers[sol$solution == 1,"bidUpTo"]))
names(sol$playerInfo) <- c("name","points","risk","avgCost","inflatedCost","bidUpTo")
sol$totalCost <- sum(removedPlayers$inflatedCost * sol$solution)
sol$players <- removedPlayers$name[sol$solution == 1]
return(sol)
}
optimizeDraft(maxRisk=3.8)
optimizeDraft <- function(points=removedPlayers$projectedPtsLatent, playerCost=removedPlayers$inflatedCost, maxRisk=maxRisk, omit=NULL){ #can change points, cost, or risk
if (length(omit) > 0){
for(i in 1:length(omit)){
removedPlayers <- removedPlayers[-which(removedPlayers$name==omit[i]),]
}
} else {}
num.players <- length(removedPlayers$name)
var.types <- rep("B", num.players)
A <- rbind(as.numeric(removedPlayers$pos == "QB"), # num QB
as.numeric(removedPlayers$pos == "RB"), # num RB
as.numeric(removedPlayers$pos == "WR"), # num WR
as.numeric(removedPlayers$pos == "TE"), # num TE
diag(removedPlayers$risk),              # player's risk
playerCost,                           # total cost
rep(1,num.players))                   # num of players in starting lineup
dir <- c("==",
">=",
">=",
">=",
rep("<=", num.players),
"<=",
"==")
b <- c(numQBstarters,
numRBstarters,
numWRstarters,
numTEstarters,
rep(maxRisk, num.players),
maxCost,
numTotalStarters)
sol <- Rglpk_solve_LP(obj = points, mat = A, dir = dir, rhs = b,types = var.types, max = TRUE)
sol$playerInfo <- as.data.frame(cbind(removedPlayers[sol$solution == 1,"name"],round(points[sol$solution == 1],2),round(removedPlayers[sol$solution == 1,"risk"],2),removedPlayers[sol$solution == 1,"avgCost"],playerCost[sol$solution == 1],removedPlayers[sol$solution == 1,"bidUpTo"]))
names(sol$playerInfo) <- c("name","points","risk","avgCost","inflatedCost","bidUpTo")
sol$totalCost <- sum(removedPlayers$inflatedCost * sol$solution)
sol$players <- removedPlayers$name[sol$solution == 1]
return(sol)
}
optimizeDraft(maxRisk=3.8)
optimizeDraft(maxRisk=3.8,omit=c("Aaron Rodgers","Steven Jackson"))
optimizeDraft(maxRisk=3.8)
draftData
drafted <- c("Aaron Rodgers","Steven Jackson")
optimizeDraft(maxRisk=3.8,omit=drafted)
draftData[!(draftData$name %in% drafted),]
#Library
library("psy")
library("psych")
library("ggplot2")
#Functions
source(paste(getwd(),"/R Scripts/Functions.R", sep=""))
#Website
#http://fifthdown.blogs.nytimes.com/2010/11/12/how-accurate-are-yahoo-espn-and-cbs-fantasy-projections/
#http://www.r-bloggers.com/dont-use-correlation-to-track-prediction-performance/
#Load data
load(paste(getwd(),"/Data/LeagueProjections-2012.RData", sep=""))
actualPoints <- read.csv(paste(getwd(),"/Data/Yahoo-actualpoints-2012.csv", sep=""))
#Cleanup Yahoo actual points data
actualPoints <- actualPoints[which(actualPoints$Fan.Pts!=""),]
actualPoints$name <- as.character(actualPoints$Player)
actualPoints$actualPts <- actualPoints$Fan.Pts
actualPoints <- actualPoints[,c("name","actualPts")]
row.names(actualPoints) <- 1:dim(actualPoints)[1]
#Change player names
actualPoints[which(actualPoints$name=="Stevie Johnson"),"name"] <- "Steve Johnson"
#Merge projections with Yahoo actual points
projectedWithActualPts <- merge(projections, actualPoints, by="name", all.x=TRUE)
#Remove duplicate cases
projectedWithActualPts[duplicated(projectedWithActualPts$name),]
projectedWithActualPts[projectedWithActualPts$name=="Alex Smith",]
projectedWithActualPts[projectedWithActualPts$name=="Steve Smith",]
projectedWithActualPts[projectedWithActualPts$name=="Alex Smith",][2,] <- NA
projectedWithActualPts <- projectedWithActualPts[!is.na(projectedWithActualPts$name),]
projectedWithActualPts[projectedWithActualPts$name=="Steve Smith",][c(1,4),] <- NA
projectedWithActualPts <- projectedWithActualPts[!is.na(projectedWithActualPts$name),]
#Correlation between projections and actual points
cor(projectedWithActualPts[,c("projectedPts_espn","projectedPts_cbs","projectedPts_nfl","projectedPts","projectedPtsLatent","actualPts")], use="pairwise.complete.obs")
#R-squared
summary(lm(actualPts ~ projectedPts_espn, data=projectedWithActualPts))$r.squared
summary(lm(actualPts ~ projectedPts_cbs, data=projectedWithActualPts))$r.squared
summary(lm(actualPts ~ projectedPts_nfl, data=projectedWithActualPts))$r.squared
summary(lm(actualPts ~ projectedPts, data=projectedWithActualPts))$r.squared
summary(lm(actualPts ~ projectedPtsLatent, data=projectedWithActualPts))$r.squared
#Absolute agreement
icc(projectedWithActualPts[,c("projectedPts_espn","actualPts")])$icc.agreement
icc(projectedWithActualPts[,c("projectedPts_cbs","actualPts")])$icc.agreement
icc(projectedWithActualPts[,c("projectedPts_nfl","actualPts")])$icc.agreement
icc(projectedWithActualPts[,c("projectedPts","actualPts")])$icc.agreement
icc(projectedWithActualPts[,c("projectedPtsLatent","actualPts")])$icc.agreement
#Harrell's c-index & Somers Dxy
rcorrcens(actualPts ~ projectedPts_espn, data=projectedWithActualPts)
rcorrcens(actualPts ~ projectedPts_cbs, data=projectedWithActualPts)
rcorrcens(actualPts ~ projectedPts_nfl, data=projectedWithActualPts)
rcorrcens(actualPts ~ projectedPts, data=projectedWithActualPts)
rcorrcens(actualPts ~ projectedPtsLatent, data=projectedWithActualPts)
#After removing cases with projected points of 0
projectedWithActualPtsNoZeros <- projectedWithActualPts[which(projectedWithActualPts$projectedPts!=0),]
#Re-evaluate correlation between projections and actual points when cases with 0 projected points were excluded
cor(projectedWithActualPtsNoZeros[,c("projectedPts_espn","projectedPts_cbs","projectedPts_nfl","projectedPts","projectedPtsLatent","actualPts")], use="pairwise.complete.obs")
#R-squared
summary(lm(actualPts ~ projectedPts_espn, data=projectedWithActualPtsNoZeros))$r.squared
summary(lm(actualPts ~ projectedPts_cbs, data=projectedWithActualPtsNoZeros))$r.squared
summary(lm(actualPts ~ projectedPts_nfl, data=projectedWithActualPtsNoZeros))$r.squared
summary(lm(actualPts ~ projectedPts, data=projectedWithActualPtsNoZeros))$r.squared
summary(lm(actualPts ~ projectedPtsLatent, data=projectedWithActualPtsNoZeros))$r.squared
#Re-evaluate Absolute agreement
icc(projectedWithActualPtsNoZeros[,c("projectedPts_espn","actualPts")])$icc.agreement
icc(projectedWithActualPtsNoZeros[,c("projectedPts_cbs","actualPts")])$icc.agreement
icc(projectedWithActualPtsNoZeros[,c("projectedPts_nfl","actualPts")])$icc.agreement
icc(projectedWithActualPtsNoZeros[,c("projectedPts","actualPts")])$icc.agreement
icc(projectedWithActualPtsNoZeros[,c("projectedPtsLatent","actualPts")])$icc.agreement
#Harrell's c-index & Somers Dxy
rcorrcens(actualPts ~ projectedPts_espn, data=projectedWithActualPtsNoZeros)
rcorrcens(actualPts ~ projectedPts_cbs, data=projectedWithActualPtsNoZeros)
rcorrcens(actualPts ~ projectedPts_nfl, data=projectedWithActualPtsNoZeros)
rcorrcens(actualPts ~ projectedPts, data=projectedWithActualPtsNoZeros)
rcorrcens(actualPts ~ projectedPtsLatent, data=projectedWithActualPtsNoZeros)
#Plot
ggplot(data=projectedWithActualPts, aes(x=projectedPtsLatent, y=actualPts)) + geom_point() + geom_smooth() + xlab("Projected Fantasy Football Points") + ylab("Actual Fantasy Football Points") + ggtitle("Association Between Projected Fantasy Points and Actual Points") +
annotate("text", x = 80, y = max(projectedWithActualPts$projectedPtsLatent), label = paste("R-Squared = ",round(summary(lm(actualPts ~ projectedPtsLatent, data=projectedWithActualPts))$r.squared,2),sep=""))
ggsave(paste(getwd(),"/Figures/Evaluate Projections 2012.jpg", sep=""))
